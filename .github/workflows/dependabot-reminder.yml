name: Dependabot PR Documentation Reminder

on:
  pull_request:
    types: [opened]

jobs:
  check-docs-update:
    # Only run for Dependabot PRs
    if: github.event.pull_request.user.login == 'dependabot[bot]'
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read

    steps:
      - name: Check if documentation update is needed
        id: check
        run: |
          # Get PR title
          title="${{ github.event.pull_request.title }}"

          needs_update=false

          # Check for major dependencies that require documentation updates
          # Backend dependencies
          if echo "$title" | grep -iE "spring-boot|spring boot|java-|eclipse-temurin|postgres"; then
            needs_update=true
          fi

          # Frontend dependencies
          if echo "$title" | grep -iE "next|react|node|typescript"; then
            needs_update=true
          fi

          # Other important dependencies
          if echo "$title" | grep -iE "maven|pnpm"; then
            needs_update=true
          fi

          echo "needs_update=$needs_update" >> $GITHUB_OUTPUT
          echo "PR title: $title"
          echo "Needs documentation update: $needs_update"

      - name: Post reminder comment
        if: steps.check.outputs.needs_update == 'true'
        uses: actions/github-script@v8
        with:
          script: |
            const prTitle = context.payload.pull_request.title;
            const prNumber = context.issue.number;

            // Determine which dependencies were updated
            let dependencyType = "ä¾å­˜é–¢ä¿‚";
            if (/spring-boot|spring boot/i.test(prTitle)) {
              dependencyType = "Spring Boot";
            } else if (/java-|eclipse-temurin/i.test(prTitle)) {
              dependencyType = "Java";
            } else if (/postgres/i.test(prTitle)) {
              dependencyType = "PostgreSQL";
            } else if (/next/i.test(prTitle)) {
              dependencyType = "Next.js";
            } else if (/react/i.test(prTitle)) {
              dependencyType = "React";
            } else if (/node/i.test(prTitle)) {
              dependencyType = "Node.js";
            } else if (/typescript/i.test(prTitle)) {
              dependencyType = "TypeScript";
            }

            const backtick = '`';
            const tripleBacktick = '```';

            const comment = '## ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼\n\n' +
              'ã“ã®ä¾å­˜é–¢ä¿‚ã®æ›´æ–°ï¼ˆ**' + dependencyType + '**ï¼‰ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ã®å½±éŸ¿ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\n' +
              '### ç¢ºèªãŒå¿…è¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\n\n' +
              '- ' + backtick + 'CLAUDE.md' + backtick + '\n' +
              '- ' + backtick + 'README.md' + backtick + '\n' +
              '- ' + backtick + 'backend/README.md' + backtick + '\n' +
              '- ' + backtick + 'backend/CLAUDE.md' + backtick + '\n' +
              '- ' + backtick + 'frontend/CLAUDE.md' + backtick + '\n' +
              '- ' + backtick + 'docs/deployment/DEPLOYMENT.md' + backtick + '\n\n' +
              '### @claude ã‚’ä½¿ã£ãŸè‡ªå‹•æ›´æ–°\n\n' +
              'ä»¥ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹ã¨ã€Claude ãŒè‡ªå‹•çš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ã¾ã™ï¼š\n\n' +
              tripleBacktick + 'markdown\n' +
              '@claude ã“ã® PR ã®ä¾å­˜é–¢ä¿‚æ›´æ–°ã«ä¼´ã„ã€é–¢é€£ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚\n\n' +
              'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:\n' +
              '- CLAUDE.md\n' +
              '- README.md\n' +
              '- backend/README.md\n' +
              '- backend/CLAUDE.md\n' +
              '- frontend/CLAUDE.md\n' +
              '- docs/deployment/DEPLOYMENT.md\n\n' +
              'å¤‰æ›´å†…å®¹ã‚’ç¢ºèªã—ã€å½±éŸ¿ã‚’å—ã‘ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚\n' +
              tripleBacktick + '\n\n' +
              '### æ‰‹å‹•æ›´æ–°\n\n' +
              'è‡ªåˆ†ã§æ›´æ–°ã™ã‚‹å ´åˆã¯ã€[Dependabot ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ã‚¬ã‚¤ãƒ‰](https://github.com/' + context.repo.owner + '/' + context.repo.repo + '/blob/master/docs/deployment/DEPENDABOT_DOCS_UPDATE.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\n\n' +
              '---\n\n' +
              'ğŸ’¡ ã“ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¯è‡ªå‹•çš„ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ãŒä¸è¦ãªå ´åˆã¯ã€ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç„¡è¦–ã—ã¦ãã ã•ã„ã€‚';

            await github.rest.issues.createComment({
              issue_number: prNumber,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

            console.log(`Posted reminder comment to PR #${prNumber}`);
